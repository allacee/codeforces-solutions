Пояснения к примененному алгоритму:
Будем рассматривать файловую систему как дерево. Количество отступов перед именем следующего файла равно его уровню в дереве. Выводить имена файлов/директорий будем в соответствии с прямым обходом этого дерева.
